# Fix: OpenAI API Key Propagation

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:** Frontend –ø–µ—Ä–µ–¥–∞–≤–∞–ª API –∫–ª—é—á —á–µ—Ä–µ–∑ header, –Ω–æ backend –µ–≥–æ –Ω–µ —á–∏—Ç–∞–ª.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ API –∫–ª—é—á–∞ —á–µ—Ä–µ–∑ body + header —Å fallback –Ω–∞ env.

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
+++ 58 —Å—Ç—Ä–æ–∫
--- 12 —Å—Ç—Ä–æ–∫
```

‚úÖ **–ë–æ–ª—å—à–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ —á–µ–º —É–¥–∞–ª–µ–Ω–æ** (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

---

## üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `netlify/functions/analyze.js`
- –î–æ–±–∞–≤–ª–µ–Ω–æ —á—Ç–µ–Ω–∏–µ API –∫–ª—é—á–∞ –∏–∑ `body.apiKey` –∏ header `X-OpenAI-API-Key`
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: body ‚Üí header ‚Üí env
- –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∫–ª—é—á–∞
- –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ (statusCode 400 –≤–º–µ—Å—Ç–æ 500)

### 2. `netlify/functions/screenshot.js`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ API –∫–ª—é—á–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 3. `index.html`
- API –∫–ª—é—á —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∏ —á–µ—Ä–µ–∑ body, –∏ —á–µ—Ä–µ–∑ header

### 4. `test.sh` (–Ω–æ–≤—ã–π)
- –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 5. `PR_DESCRIPTION.md` (–Ω–æ–≤—ã–π)
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è PR

---

## üîç –ß—Ç–æ –ù–ï –∏–∑–º–µ–Ω–µ–Ω–æ

- ‚ùå –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ù–ï —É–¥–∞–ª—ë–Ω
- ‚ùå –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ù–ï –∏–∑–º–µ–Ω–µ–Ω–∞
- ‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ù–ï –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚ùå CI/CD –ù–ï –∏–∑–º–µ–Ω—ë–Ω

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å
```bash
node -c netlify/functions/analyze.js    # ‚úÖ OK
node -c netlify/functions/screenshot.js # ‚úÖ OK
```

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
```bash
export TEST_API_KEY="sk-proj-..."
bash test.sh
```

---

## üìã Acceptance Criteria

- [x] +++ –±–æ–ª—å—à–µ —á–µ–º --- ‚úÖ
- [x] –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ù–ï —É–¥–∞–ª—ë–Ω ‚úÖ
- [x] –¢–æ–ª—å–∫–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–ª—é—á–æ–º ‚úÖ
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ ‚úÖ
- [x] –°–æ–∑–¥–∞–Ω test.sh ‚úÖ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ nlabteam.com (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è)

---

## üöÄ –î–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ merge –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã –Ω–∞ Netlify.

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É:
1. –û—Ç–∫—Ä—ã—Ç—å https://nlabteam.com
2. –ù–∞–∂–∞—Ç—å "üîå –ü–æ–¥–∫–ª—é—á–∏—Ç—å API OpenAI"
3. –í–≤–µ—Å—Ç–∏ API –∫–ª—é—á
4. –í–≤–µ—Å—Ç–∏ URL –∏ –Ω–∞–∂–∞—Ç—å "–ù–∞–π—Ç–∏"
5. ‚úÖ –î–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–∫–∏

---

## üîë –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á–∞ –∫–ª—é—á–∞

```
Frontend (localStorage)
    ‚Üì
    ‚îú‚Üí headers['X-OpenAI-API-Key'] = apiKey
    ‚îî‚Üí body.apiKey = apiKey
    ‚Üì
Backend (analyze.js)
    ‚Üì
    ‚îú‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç body.apiKey
    ‚îú‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç header['x-openai-api-key']
    ‚îî‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç process.env.OPENAI_API_KEY
    ‚Üì
OpenAI API
```

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- API –∫–ª—é—á –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ HTTPS (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
- –ö–ª—é—á –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é (—Ç–æ–ª—å–∫–æ –ø—Ä–µ—Ñ–∏–∫—Å)
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: env –∫–ª—é—á –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
- –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .env —Ñ–∞–π–ª

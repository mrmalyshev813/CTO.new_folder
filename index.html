<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Анализатор рекламных мест - Adlook</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; }
        input { width: 100%; padding: 10px; font-size: 16px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin-top: 10px; }
        #result { margin-top: 30px; white-space: pre-wrap; background: #f5f5f5; padding: 20px; display: none; }
        #loading { display: none; color: #666; margin-top: 10px; }
        .zone { background: white; padding: 10px; margin: 10px 0; border-left: 4px solid #28a745; }
        .api-key-section { background: #fff3cd; padding: 15px; margin-bottom: 20px; border-radius: 5px; border-left: 4px solid #ffc107; }
        #apiKeyInput { font-family: monospace; font-size: 14px; }
    </style>
</head>
<body>
    <h1>Анализатор рекламных мест</h1>
    <p>от компании Adlook</p>
    
    <div class="api-key-section">
        <label for="apiKeyInput"><strong>OpenAI API Key:</strong></label>
        <input type="password" id="apiKeyInput" placeholder="Введите ваш OpenAI API ключ" />
        <small style="color: #666; display: block; margin-top: 5px;">Ключ сохраняется локально в браузере</small>
    </div>
    
    <input type="url" id="urlInput" placeholder="Введите URL сайта (например: https://nlabteam.com)" />
    <button onclick="analyze()">Анализировать</button>
    
    <div id="loading">
        ⏳ Анализируем сайт...<br>
        <small>Делаем скриншот и анализируем визуальную структуру с помощью AI</small>
    </div>
    <div id="result"></div>

    <script>
        function getApiKey() {
            let apiKey = document.getElementById('apiKeyInput').value;
            if (!apiKey) {
                apiKey = localStorage.getItem('openai_api_key');
                if (apiKey) {
                    document.getElementById('apiKeyInput').value = apiKey;
                }
            } else {
                localStorage.setItem('openai_api_key', apiKey);
            }
            return apiKey;
        }
        
        async function analyze() {
            const url = document.getElementById('urlInput').value;
            if (!url) return alert('Введите URL');
            
            const apiKey = getApiKey();
            if (!apiKey) return alert('Введите OpenAI API ключ');
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            
            try {
                // 1. Get screenshot URL
                const screenshotUrl = await getScreenshot(url);
                
                // 2. Analyze screenshot with OpenAI Vision
                const analysis = await analyzeWithVision(url, screenshotUrl, apiKey);
                
                // 3. Generate proposal
                const proposal = generateProposal(url, analysis.zones);
                
                // 4. Display results
                displayResults(proposal, analysis.zones, screenshotUrl);
                
            } catch (error) {
                alert('Ошибка: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        async function getScreenshot(url) {
            return `https://image.thum.io/get/width/1200/crop/800/${url}`;
        }
        
        async function analyzeWithVision(url, screenshotUrl, apiKey) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: [{
                        role: 'user',
                        content: [
                            {
                                type: 'text',
                                text: `Проанализируй скриншот сайта ${url} и определи где можно разместить рекламу.

Визуально оцени структуру страницы и определи следующие рекламные зоны:

1. Header (Шапка) - верхняя часть страницы, навигация
2. Sidebar (Боковая панель) - правая или левая колонка
3. Content (Контент) - между статьями, в основном контенте
4. Footer (Подвал) - нижняя часть страницы
5. Popup (Всплывающее окно) - есть ли модальные окна

Для каждой найденной зоны укажи:
- name: название зоны
- priority: "high" для самых заметных мест, "medium" для менее заметных, "low" для незаметных
- description: почему это хорошее место для рекламы, какой размер баннера подойдет

ВАЖНО: Указывай только зоны с приоритетом high или medium (приоритетные места).

Верни только JSON в формате:
{
  "zones": [
    {"name": "Header", "priority": "high", "description": "Верхняя часть страницы с большой площадью, идеально для баннера 728x90 или 970x250"},
    {"name": "Sidebar", "priority": "medium", "description": "Правая колонка, подходит для баннеров 300x250 или 300x600"}
  ]
}`
                            },
                            {
                                type: 'image_url',
                                image_url: {
                                    url: screenshotUrl,
                                    detail: 'low'
                                }
                            }
                        ]
                    }],
                    response_format: { type: 'json_object' },
                    max_tokens: 1000
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`OpenAI API error: ${error.error?.message || response.statusText}`);
            }
            
            const result = await response.json();
            return JSON.parse(result.choices[0].message.content);
        }
        
        function generateProposal(url, zones) {
            const priorityZones = zones.filter(z => z.priority === 'high' || z.priority === 'medium');
            const zonesList = priorityZones.map((z, i) => {
                const priorityText = z.priority === 'high' ? 'высокий приоритет' : 'средний приоритет';
                return `${i+1}. ${z.name} - ${priorityText}\n   ${z.description}`;
            }).join('\n\n');
            
            return `Тема: Предложение по рекламе на сайте ${url}

Здравствуйте!

Прежде всего хочу поздравить вас с успешным развитием вашего ресурса. ${url} привлекает широкую аудиторию. Мы в Adlook уверены, что грамотное размещение рекламы позволит значительно увеличить доход.

Немного о нас: Adlook - это российская SSP-платформа (Supply-Side Platform), основанная в 2018 году в Санкт-Петербурге. Мы помогаем владельцам сайтов монетизировать свои ресурсы с помощью баннерной и видеорекламы. За время работы мы показали более 6 миллиардов рекламных креативов и выплатили партнерам более 550 миллионов рублей.

Мы проанализировали ваш сайт и выделили несколько эффективных зон для размещения рекламы:

${zonesList}

Потенциальный доход: от 50,000 до 150,000 рублей в месяц.

Что мы предлагаем:
- Сроки размещения: от одного месяца
- Форматы: баннеры, контекстная реклама, всплывающие окна
- Программная настройка рекламы под ваш сайт
- Полная аналитика и отчеты по эффективности

Мы уверены, что сотрудничество с Adlook станет взаимовыгодным. Давайте обсудим детали лично или по телефону!

С уважением,
Менеджер по работе с партнёрами, Adlook`;
        }
        
        function displayResults(proposal, zones, screenshotUrl) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <div style="margin: 20px 0;">
                    <h3>Скриншот сайта:</h3>
                    <div style="border: 2px solid #e0e0e0; border-radius: 8px; padding: 10px; background: white;">
                        <img src="${screenshotUrl}" alt="Скриншот сайта" style="max-width: 100%; height: auto; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" />
                    </div>
                </div>
                
                <h3>Найденные рекламные зоны (по визуальному анализу AI):</h3>
                ${zones.map(z => `
                    <div class="zone" style="background: white; padding: 15px; margin: 10px 0; border-left: 4px solid ${z.priority === 'high' ? '#28a745' : '#ffc107'}; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <strong style="font-size: 18px;">${z.name}</strong>
                            <span style="background: ${z.priority === 'high' ? '#28a745' : '#ffc107'}; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                                ${z.priority === 'high' ? 'ВЫСОКИЙ ПРИОРИТЕТ' : 'СРЕДНИЙ ПРИОРИТЕТ'}
                            </span>
                        </div>
                        <p style="margin: 0; color: #666;">${z.description}</p>
                    </div>
                `).join('')}
                
                <div style="margin-top: 30px;">
                    <h3>Коммерческое предложение от Adlook:</h3>
                    <div style="background: white; padding: 25px; border: 1px solid #ddd; border-radius: 8px; white-space: pre-wrap; line-height: 1.6;">
${proposal}
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button onclick="copyToClipboard()" style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-right: 10px;">
                        📋 Копировать письмо
                    </button>
                </div>
            `;
            resultDiv.style.display = 'block';
            window.currentProposal = proposal;
        }
        
        function copyToClipboard() {
            navigator.clipboard.writeText(window.currentProposal);
            alert('✅ Текст коммерческого предложения скопирован в буфер обмена!');
        }
        
        // Load saved API key on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedApiKey = localStorage.getItem('openai_api_key');
            if (savedApiKey) {
                document.getElementById('apiKeyInput').value = savedApiKey;
            }
        });
    </script>
    
    <footer style="margin-top: 50px; text-align: center; color: #666;">
        AI-powered анализ рекламных мест by NLABTEAM
    </footer>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Анализатор рекламных мест - Adlook</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; }
        input { width: 100%; padding: 10px; font-size: 16px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin-top: 10px; }
        #result { margin-top: 30px; white-space: pre-wrap; background: #f5f5f5; padding: 20px; display: none; }
        #loading { display: none; color: #666; margin-top: 10px; }
        .zone { background: white; padding: 10px; margin: 10px 0; border-left: 4px solid #28a745; }
        .api-key-section { background: #fff3cd; padding: 15px; margin-bottom: 20px; border-radius: 5px; border-left: 4px solid #ffc107; }
        #apiKeyInput { font-family: monospace; font-size: 14px; }
    </style>
</head>
<body>
    <h1>Анализатор рекламных мест</h1>
    <p>от компании Adlook</p>
    
    <div class="api-key-section">
        <label for="apiKeyInput"><strong>OpenAI API Key:</strong></label>
        <input type="password" id="apiKeyInput" placeholder="Введите ваш OpenAI API ключ" />
        <small style="color: #666; display: block; margin-top: 5px;">Ключ сохраняется локально в браузере</small>
    </div>
    
    <input type="url" id="urlInput" placeholder="Введите URL сайта (например: https://nlabteam.com)" />
    <button onclick="analyze()">Анализировать</button>
    
    <div id="loading">Анализируем сайт...</div>
    <div id="result"></div>

    <script>
        function getApiKey() {
            let apiKey = document.getElementById('apiKeyInput').value;
            if (!apiKey) {
                apiKey = localStorage.getItem('openai_api_key');
                if (apiKey) {
                    document.getElementById('apiKeyInput').value = apiKey;
                }
            } else {
                localStorage.setItem('openai_api_key', apiKey);
            }
            return apiKey;
        }
        
        async function analyze() {
            const url = document.getElementById('urlInput').value;
            if (!url) return alert('Введите URL');
            
            const apiKey = getApiKey();
            if (!apiKey) return alert('Введите OpenAI API ключ');
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            
            try {
                // Fetch website
                const htmlResponse = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                const data = await htmlResponse.json();
                
                // Analyze with OpenAI
                const analysis = await analyzeWithAI(url, data.contents, apiKey);
                
                // Generate proposal
                const proposal = generateProposal(url, analysis.zones);
                
                // Display results
                displayResults(proposal, analysis.zones);
                
            } catch (error) {
                alert('Ошибка: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        async function analyzeWithAI(url, html, apiKey) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: [{
                        role: 'user',
                        content: `Проанализируй сайт ${url} и определи потенциальные рекламные зоны.
                        
Определи наличие и приоритет (high/medium/low) для этих зон:
1. Header (шапка сайта)
2. Sidebar (боковая панель)
3. Content (основной контент)
4. Footer (подвал)
5. Popup (всплывающие окна)

Верни JSON:
{
  "zones": [
    {"name": "Header", "priority": "high", "description": "описание"},
    ...
  ]
}`
                    }],
                    response_format: { type: 'json_object' }
                })
            });
            
            const result = await response.json();
            return JSON.parse(result.choices[0].message.content);
        }
        
        function generateProposal(url, zones) {
            const priorityZones = zones.filter(z => z.priority === 'high' || z.priority === 'medium');
            const zonesList = priorityZones.map((z, i) => `${i+1}. ${z.name} - ${z.priority === 'high' ? 'высокий приоритет' : 'средний приоритет'}\n   ${z.description}`).join('\n\n');
            
            return `Тема: Предложение по рекламе на сайте ${url}

Здравствуйте!

Прежде всего хочу поздравить вас с успешным развитием вашего ресурса. ${url} привлекает широкую аудиторию. Мы в Adlook уверены, что грамотное размещение рекламы позволит значительно увеличить доход.

Немного о нас: Adlook - это российская SSP-платформа (Supply-Side Platform), основанная в 2018 году в Санкт-Петербурге. Мы помогаем владельцам сайтов монетизировать свои ресурсы с помощью баннерной и видеорекламы.

Мы проанализировали ваш сайт и выделили несколько эффективных зон для размещения рекламы:

${zonesList}

Потенциальный доход: от 50,000 до 150,000 рублей в месяц.

Что мы предлагаем:
- Сроки размещения: от одного месяца
- Форматы: баннеры, контекстная реклама, всплывающие окна
- Программная настройка рекламы под ваш сайт
- Полная аналитика и отчеты по эффективности

Мы уверены, что сотрудничество с Adlook станет взаимовыгодным. Давайте обсудим детали!

С уважением,
Менеджер по работе с партнёрами, Adlook`;
        }
        
        function displayResults(proposal, zones) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <h3>Найденные рекламные зоны:</h3>
                ${zones.map(z => `<div class="zone"><strong>${z.name}</strong> (${z.priority})<br>${z.description}</div>`).join('')}
                
                <h3>Коммерческое предложение:</h3>
                <div style="background: white; padding: 20px;">${proposal}</div>
                
                <button onclick="copyToClipboard()">Копировать письмо</button>
            `;
            resultDiv.style.display = 'block';
            window.currentProposal = proposal;
        }
        
        function copyToClipboard() {
            navigator.clipboard.writeText(window.currentProposal);
            alert('Текст скопирован!');
        }
        
        // Load saved API key on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedApiKey = localStorage.getItem('openai_api_key');
            if (savedApiKey) {
                document.getElementById('apiKeyInput').value = savedApiKey;
            }
        });
    </script>
    
    <footer style="margin-top: 50px; text-align: center; color: #666;">
        AI-powered анализ рекламных мест by NLABTEAM
    </footer>
</body>
</html>
